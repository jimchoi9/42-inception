# FROM debian:bullseye

# RUN apt-get update && apt-get install -y mariadb-server

# # MariaDB 설정 파일 복사
# COPY conf/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf

# # 데이터베이스 초기화 스크립트 복사
# COPY tools/database_setup.sh /usr/local/bin/
# RUN chmod +x /usr/local/bin/database_setup.sh

# EXPOSE 3306

# CMD ["/usr/local/bin/database_setup.sh"]

FROM debian:bullseye

# MariaDB 서버 설치
RUN apt-get update && apt-get install -y mariadb-server

# MariaDB 설정 파일 복사
COPY conf/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf

# 데이터베이스 초기화 스크립트 복사
COPY tools/database_setup.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# MariaDB 기본 포트 노출
EXPOSE 3306

# 컨테이너 시작 시 항상 실행되는 초기화 스크립트 지정 (PID 1)
ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]

# 초기화 스크립트 완료 후 실행될 기본 명령
# 스크립트는 보통 exec "$@"로 끝나며 이 명령을 실행함
CMD ["mysqld", "--user=mysql"]